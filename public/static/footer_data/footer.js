function evpPopupFooter(a,b){pm({target:window.parent,type:"existence-popup-frame",data:{prefix:a,url:b},url:document.referrer})}function evpFooterGetStatistic(){var a=document.body.querySelector(".evp-footer_statistic");generateStatistic(a.getAttribute("data-url"),a.getAttribute("data-id")).then(function(b){b&&b.site&&b.all?(a.querySelector(".evp-footer_stat:first-child .evp-footer_stat_num").innerHTML=b.site,a.querySelector(".evp-footer_stat:last-child .evp-footer_stat_num").innerHTML=b.all):a.style.display="none"})}function generateMaps(a,b){return new Promise(function(c,d){if(sessionStorage[a])c(sessionStorage.getItem(a));else{var e="",f="",g="",h="";$.ajax({url:b,type:"GET",dataType:"json",success:function(b){if(b.length>0){h='<div class="evp-footer_popup-header evp-footer_popup-header_map">Карта сайта <div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div>';for(var d=0;d<b.length;d++)e='<li class="evp-footer-map_item"><a href="'+b[d].url+'" target="_parent" class="evp-footer-map_item-link">'+b[d].title+"</a></li>",g+=e;g&&(f='<ul class="evp-footer-map_list">'+g+"</ul>"),map='<div class="evp-footer-map">'+h+'<div class="evp-footer-map-site evp-popup-scroll">'+f+"</div></div>",sessionStorage.setItem(a,map),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(map)}else map='<div class="evp-footer-map">'+h+'<div class="evp-footer-map-site"><div class="evp-footer_error">Извините, произошла ошибка</div></div></div>',sessionStorage.setItem(a,map),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(map)},error:function(){map='<div class="evp-footer-map">'+h+'<div class="evp-footer-map-site"><div class="evp-footer_error">Извините, произошла ошибка</div></div></div>',sessionStorage.setItem(a,map),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(map)}})}})}function trailingSlash(a){return a.replace("/","").replace("www.","")}function generateStatistic(a,b){return new Promise(function(c,d){if(checkIfResourcesInLocalStorage("statistic_time"+b,"statistic"+b)){var e=JSON.parse(sessionStorage.getItem("statistic"+b));c(e)}else{var f="",g="",h="",i="",j="",k="",l="",m="";$.ajax({url:a,type:"GET",dataType:"json",success:function(a){if(a&&a.items){if(a.items.sites){if(a.items.sites.moscow){i='<div class="evp-footer_popup-header">Сайты Москвы <div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div>';for(var d=0;d<a.items.sites.moscow.length;d++)g='<a href="'+a.items.sites.moscow[d].url+'" target="_blank" class="evp-footer-portals_lnk"><div class="evp-footer-portals_link-title">'+a.items.sites.moscow[d].description+(a.items.sites.moscow[d].title?"<span>"+trailingSlash(a.items.sites.moscow[d].title)+"</span>":"")+"</div></a>",h+=g;h&&(f="<div>"+i+'<div class="evp-footer-portals evp-popup-scroll">'+h+"</div></div>",sessionStorage.setItem("moscow",f),sessionStorage.setItem("moscow_time",(new Date).getTime()))}if(a.items.sites.russia){m='<div class="evp-footer_popup-header">Сайты России <div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div>';for(var d=0;d<a.items.sites.russia.length;d++)k='<a href="'+a.items.sites.russia[d].url+'" target="_blank" class="evp-footer-portals_lnk"><div class="evp-footer-portals_link-title">'+a.items.sites.russia[d].description+(a.items.sites.russia[d].title?"<span>"+trailingSlash(a.items.sites.russia[d].title)+"</span>":"")+"</div></a>",l+=k;l&&(j="<div>"+m+'<div class="evp-footer-portals evp-popup-scroll">'+l+"</div></div>",sessionStorage.setItem("russia",j),sessionStorage.setItem("russia_time",(new Date).getTime()))}}a.items.statistic&&(sessionStorage.setItem("statistic"+b,JSON.stringify(a.items.statistic)),sessionStorage.setItem("statistic_time"+b,(new Date).getTime()),c(a.items.statistic))}else c(!1)},error:function(){c(!1)}})}})}function generateSites(a,b){return new Promise(function(c,d){if(sessionStorage[a])c(sessionStorage.getItem(a));else{var e="",f="",g="",h="",i="",j="",k="",l="";$.ajax({url:b,type:"GET",dataType:"json",success:function(b){if(b){if("moscow"==a){h='<div class="evp-footer_popup-header">'+b[0].title+' <div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div>';for(var d=0;d<b[0].items.length;d++)f='<a href="'+b[0].items[d].url+'" target="_blank" class="evp-footer-portals_lnk"><div class="evp-footer-portals_link-title">'+b[0].items[d].title+(b[0].items[d].caption?"<span>"+trailingSlash(b[0].items[d].caption)+"</span>":"")+"</div></a>",g+=f;g&&(e="<div>"+h+'<div class="evp-footer-portals evp-popup-scroll">'+g+"</div></div>",sessionStorage.setItem(a,e),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(e))}if("russia"==a){l='<div class="evp-footer_popup-header">'+b[1].title+' <div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div>';for(var d=0;d<b[1].items.length;d++)j='<a href="'+b[1].items[d].url+'" target="_blank" class="evp-footer-portals_lnk"><div class="evp-footer-portals_link-title">'+b[1].items[d].title+(b[1].items[d].caption?"<span>"+trailingSlash(b[1].items[d].caption)+"</span>":"")+"</div></a>",k+=j;k&&(i="<div>"+l+'<div class="evp-footer-portals evp-popup-scroll">'+k+"</div></div>",sessionStorage.setItem(a,i),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(i))}}else e='<div><div class="evp-footer_popup-header"><div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div><div class="evp-footer-portals"><div class="evp-footer_error">Извините, произошла ошибка</div></div></div>',sessionStorage.setItem(a,e),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(e)},error:function(){e='<div><div class="evp-footer_popup-header"><div class="evp-footer_popup-close" onclick="evpHidePopupFooter()"></div></div><div class="evp-footer-portals"><div class="evp-footer_error">Извините, произошла ошибка</div></div></div>',sessionStorage.setItem(a,e),sessionStorage.setItem(a+"_time",(new Date).getTime()),c(e)}})}})}function evpOpenPopupFooter(a,b){"SiteMap"==a?generateMaps(a,b).then(function(b){pm({target:window.parent,type:"show-popup-frame",data:{html:b,prefix:a},url:document.referrer})}):generateSites(a,b).then(function(b){pm({target:window.parent,type:"show-popup-frame",data:{html:b,prefix:a},url:document.referrer})})}function sendHeight(){pm({target:window.parent,type:"resize_footer",data:{height:document.body.offsetHeight+"px"},success:function(a){},url:document.referrer}),pm.bind("request_resize_footer",sendHeight)}function getCookie(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return b?decodeURIComponent(b[1]):void 0}function checkIfResourcesInLocalStorage(a,b){var c=(new Date).getTime();return!(!sessionStorage[a]||sessionStorage[a]&&c-sessionStorage[a]>9e5||!sessionStorage[b]||!JSON.stringify(sessionStorage[b]))}!function(){$(document).on("click",".evp-footer_nav_lnk",function(a){a.preventDefault(),evpPopupFooter($(this).data("id"),$(this).data("url"))}),pm.bind("is-popup-frame-popup-frame",function(a){evpOpenPopupFooter(a.prefix,a.url)}),pm({target:window.parent,type:"footer-ready"}),$(document).off("click.blindVersion").on("click.blindVersion",".evp-footer_blind",function(a){a.preventDefault(),"Y"==getCookie("EVP_blindVersion")?(pm({target:window.parent,type:"blindVersion",data:{blindVersion:!1},success:function(a){},url:document.referrer}),document.body.removeAttribute("class"),document.cookie="EVP_blindVersion=N; path=.mos.ru; expires=0",pm({target:window.parent,type:"document.cookie",data:{"document.cookie":"EVP_blindVersion=N; path=.mos.ru; expires=0"},success:function(a){},url:document.referrer})):(pm({target:window.parent,type:"blindVersion",data:{blindVersion:!0},success:function(a){},url:document.referrer}),document.body.className="evp-footer-contrast",document.cookie="EVP_blindVersion=Y; path=.mos.ru; expires=0",pm({target:window.parent,type:"document.cookie",data:{"document.cookie":"EVP_blindVersion=Y; path=.mos.ru; expires=0"},success:function(a){},url:document.referrer}))})}(),$(window).on("resize",sendHeight),$(window).on("load",function(){sendHeight(),evpFooterGetStatistic(),getCookie("EVP_blindVersion")&&"Y"==getCookie("EVP_blindVersion")&&(document.body.className="evp-footer-contrast")});